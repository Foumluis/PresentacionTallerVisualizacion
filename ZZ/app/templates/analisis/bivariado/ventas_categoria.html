{% extends 'base.html' %}

{% block title %}Cantidad de Ventas por Categoría{% endblock %}

{% block content %}


<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="bi bi-cart-check me-2"></i>Cantidad de Ventas por Categoría</h2>
            <p class="text-muted">Análisis del volumen de ventas en cada categoría de productos</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Distribución de Ventas</h5>
                </div>
                <div class="card-body">
                    <canvas id="ventasCategoriaChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Top Categorías</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Ropa
                            <span class="badge bg-primary rounded-pill">{{ y.0 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Accesorios
                            <span class="badge bg-primary rounded-pill">{{ y.1 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Calzado
                            <span class="badge bg-primary rounded-pill">{{ y.2 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Outerwear
                            <span class="badge bg-primary rounded-pill">{{ y.3 }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ y|json_script:"y" }}
{{ x|json_script:"x" }}

<script>

    const y = JSON.parse(document.getElementById('y').textContent);
    const x = JSON.parse(document.getElementById('x').textContent);


            // obtener el contexto 2D del canvas
    const ctx = document.getElementById('ventasCategoriaChart').getContext('2d');
    let delayed

    const miGrafico = new Chart(ctx, {// grafico y el indice
      type: 'bar',// tipo de barra
      data: {
        labels:x,// nombre del eje x
        datasets: [{//datos a ocupar
          label: 'Ventas ($)',//nombre del eje y
          data: y,//datos
          backgroundColor: ["#7EEC7E", "#7fa7c4", "#f48787", "#fdce87"],//color de las barras
          borderColor: 'rgba(54, 162, 235, 1)',//color de los bordes
          borderWidth: 1// tamaño del borde
        }]
      },
      options: {//opciones
        animation: {
              onComplete: () => {
                delayed = true;
              },
              delay: (context) => {
                let delay = 0;
                if (context.type === 'data' && context.mode === 'default' && !delayed) {
                  delay = context.dataIndex * 300 + context.datasetIndex * 100;
                }
                return delay;
              },
        },
        responsive: true,// si al pasar por encima se coloca algun tipo de informacion
        plugins: {
          legend: { display: false }// no mostrar la leyenda
        },
        scales: {
          y: {
            beginAtZero: true,// indicamos que empiece de cero
            title: { display: true, text: 'Monto en dólares' }//titulo del eje y
          },
          x: {
            title: { display: true, text: 'Meses' }//titulo del eje x
          }
        }
      }
    });
</script>
{% endblock %}
